(this["webpackJsonpauto-drive-network-app"]=this["webpackJsonpauto-drive-network-app"]||[]).push([[0],{121:function(e,t){},124:function(e,t,a){"use strict";a.r(t);var n,o=a(1),r=a.n(o),c=a(18),i=a.n(c),l=a(23),s=a(3),d=a(12),u=a(10),p=a(11),m=a(14),f=a(40),E=a.n(f),O=a(22),v=a(65),h={APP_MODE_LIST:{VIEW_MAP:"view_map",CREATE_MAP:"create_map"},COMPLETED_TRIP_VEHICLE_ID:"__trip_completed__",BUILD_ACTIONS:{ADD_LOCATION:"ADD_LOCATION",ADD_INTERSECTION:"ADD_INTERSECTION",BUILD_MAJOR_ROAD:"BUILD_MAJOR_ROAD",BUILD_MINOR_ROAD:"BUILD_MINOR_ROAD",BUILD_LOCAL_ROAD:"BUILD_LOCAL_ROAD",DELETE_COMPONENTS:"DELETE_COMPONENTS",RESET_POINTER:"RESET_POINTER",SAVE_MAP:"SAVE_MAP"}},b="UPDATE_MAP_DATA_LOADED",D="UPDATE_AVERAGE_RENDERS_PER_SECOND",y="UPDATE_AVERAGE_UPDATES_PER_SECOND",S="UPDATE_CUR_MODE",g="UPDATE_SELECTED_COMPONENT",T="UPDATE_HOVERED_COMPONENT",C="UPDATE_SHOW_DYNAMIC_LABELS",A="UPDATE_SHOW_STATIC_LABELS",I="UPDATE_SHOW_TOGGLE_DYNAMIC_LABELS",_="UPDATE_SHOW_FPS_WARNING",L="UPDATE_SHOW_ABOUT_MODAL",P="UPDATE_CUR_TRIP_VEHICLE_ID",w="UPDATE_FOLLOW_CUR_TRIP_VEHICLE",R="UPDATE_CANVAS_DIMENSIONS",M="UPDATE_CANVAS_PROPS_BY_DIFF",j="UPDATE_CANVAS_PROPS",N="UPDATE_CANVAS_PROPS_BY_ZOOM_FACTOR",k="UPDATE_CANVAS_OFFSET",U={setShowAboutModal:function(e){return{type:L,payload:e}},setFollowCurTripVehicle:function(e){return{type:w,payload:e}},setCanvasOffset:function(e){return{type:k,payload:e}},setCanvasPropsZoom:function(e,t){return{type:N,payload:{zoomOffsetFromViewCentre:t,zoomFactor:e}}},setCanvasPropsDiff:function(e){return{type:M,payload:e}},setCanvasProps:function(e){return{type:j,payload:e}},setCanvasDimensions:function(e){return{type:R,payload:e}},setCurMode:function(e){return{type:S,payload:e}},setSelectedComponent:function(e){return{type:g,payload:e}},setHoveredComponent:function(e){return{type:T,payload:e}},setShowDynamicLabels:function(e){return{type:C,payload:e}},setShowStaticLabels:function(e){return{type:A,payload:e}},setShowToggleDynamicLabels:function(e){return{type:I,payload:e}},setShowFpsWarning:function(e){return{type:_,payload:e}},setCurTripVehicleId:function(e){return{type:P,payload:e}},setMapDataLoaded:function(e){return{type:b,payload:e}},setAverageUpdatesPerSecond:function(e){return{type:y,payload:e}},setAverageRendersPerSecond:function(e){return{type:D,payload:e}}},V={mapDataLoaded:!1,averageUpdatesPerSecond:Number.POSITIVE_INFINITY,averageRendersPerSecond:Number.POSITIVE_INFINITY,curMode:h.APP_MODE_LIST.VIEW_MAP,selectedComponent:null,hoveredComponent:null,showLabels:{dynamic:!0,static:!0},curTripVehicleId:null,followCurTripVehicle:!1,showToggleDynamicLabels:!0,showLowFpsWarning:!1,shownLowFpsWarning:!1,showAboutModal:!0,canvasDimensions:{width:0,height:0},canvasProps:{centerX:0,centerY:0,zoom:.5},canvasOffset:{left:0,top:0}},x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case L:return Object(s.a)(Object(s.a)({},e),{},{showAboutModal:t.payload});case w:return Object(s.a)(Object(s.a)({},e),{},{followCurTripVehicle:t.payload,canvasProps:Object(s.a)(Object(s.a)({},e.canvasProps),{},{zoom:t.payload?1:e.canvasProps.zoom})});case k:return Object(s.a)(Object(s.a)({},e),{},{canvasOffset:Object(s.a)(Object(s.a)({},e.canvasOffset),t.payload)});case D:return Object(s.a)(Object(s.a)({},e),{},{averageRendersPerSecond:t.payload});case y:return Object(s.a)(Object(s.a)({},e),{},{averageUpdatesPerSecond:t.payload});case b:return Object(s.a)(Object(s.a)({},e),{},{mapDataLoaded:t.payload});case N:var a=t.payload,n=a.zoomOffsetFromViewCentre,o=a.zoomFactor,r={x:n.x+e.canvasProps.centerX,y:n.y+e.canvasProps.centerY};return Object(s.a)(Object(s.a)({},e),{},{canvasProps:{centerX:e.canvasProps.centerX-r.x*(1-o),centerY:e.canvasProps.centerY-r.y*(1-o),zoom:e.canvasProps.zoom*o}});case M:return Object(s.a)(Object(s.a)({},e),{},{canvasProps:{centerX:t.payload.centerX?e.canvasProps.centerX+t.payload.centerX:e.canvasProps.centerX,centerY:t.payload.centerY?e.canvasProps.centerY+t.payload.centerY:e.canvasProps.centerY,zoom:t.payload.zoom?e.canvasProps.zoom*t.payload.zoom:e.canvasProps.zoom}});case j:return Object(s.a)(Object(s.a)({},e),{},{canvasProps:Object(s.a)(Object(s.a)({},e.canvasProps),t.payload)});case R:return Object(s.a)(Object(s.a)({},e),{},{canvasDimensions:Object(s.a)(Object(s.a)({},e.canvasDimensions),t.payload)});case S:return Object(s.a)(Object(s.a)({},e),{},{curMode:t.payload,selectedComponent:null,hoveredComponent:null,mapDataLoaded:t.payload===h.APP_MODE_LIST.CREATE_MAP});case g:return Object(s.a)(Object(s.a)({},e),{},{selectedComponent:t.payload});case T:return Object(s.a)(Object(s.a)({},e),{},{hoveredComponent:t.payload});case C:return Object(s.a)(Object(s.a)({},e),{},{showLabels:Object(s.a)(Object(s.a)({},e.showLabels),{},{dynamic:t.payload})});case A:return Object(s.a)(Object(s.a)({},e),{},{showLabels:Object(s.a)(Object(s.a)({},e.showLabels),{},{static:t.payload})});case I:return Object(s.a)(Object(s.a)({},e),{},{showToggleDynamicLabels:t.payload});case _:return t.payload&&!e.shownLowFpsWarning?Object(s.a)(Object(s.a)({},e),{},{showLowFpsWarning:!0,shownLowFpsWarning:!0}):Object(s.a)(Object(s.a)({},e),{},{showLowFpsWarning:!1});case P:return Object(s.a)(Object(s.a)({},e),{},{curTripVehicleId:t.payload});default:return e}},Y=a(66);function W(){return n}var B=function(){function e(){Object(u.a)(this,e)}return Object(p.a)(e,null,[{key:"generateShortUuid",value:function(){return this.shortUuidGenerator.generate()}},{key:"getCanvasViewCutoffs",value:function(){var e=W().getState().canvasDimensions;return{left:0,right:e.width,top:0,bottom:e.height}}},{key:"checkCoordinateInCanvasView",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=this.getCanvasViewCutoffs(),n=e[0]+t/2>=a.left,o=e[0]-t/2<=a.right,r=e[1]+t/2>=a.top,c=e[1]-t/2<=a.bottom;return n&&o&&r&&c}},{key:"getCoordFromWaypoint",value:function(e,t){return e.startsWith("intersection")?t.intersections[e].coord:e.startsWith("location")?t.locations[e].coord:null}},{key:"getDistanceBetweenArrayCoords",value:function(e,t){for(var a=0,n=0;n<e.length;n++)a+=Math.pow(t[n]-e[n],2);return Math.sqrt(a)}},{key:"mapArrayCoord",value:function(t){return t?t.map(e.mapSingleCoord):null}},{key:"unmapArrayCoord",value:function(t){return t?t.map(e.unmapSingleCoord):null}},{key:"scaleSingleCoord",value:function(e){return e*W().getState().canvasProps.zoom}},{key:"unscaleSingleCoord",value:function(e){return e/W().getState().canvasProps.zoom}},{key:"mapSingleCoord",value:function(t,a){var n=e.scaleSingleCoord(t),o=W().getState(),r=o.canvasDimensions,c=o.canvasProps;return 0===a?n+=r.width/2-c.centerX:1===a&&(n+=r.height/2-c.centerY),n}},{key:"unmapSingleCoord",value:function(t,a){var n=t,o=W().getState(),r=o.canvasDimensions,c=o.canvasProps;return 0===a?n-=r.width/2-c.centerX:1===a&&(n-=r.height/2-c.centerY),e.unscaleSingleCoord(n)}}]),e}();B.shortUuidGenerator=E()(E.a.constants.flickrBase58);var F=a(32),z={ROAD_DRIVING_SIDE:{LEFT:"left",RIGHT:"right"},VEHICLE_STATE:{SPAWNED:"spawned",DEPARTURE_READY:"departure_ready",EN_ROUTE:"en_route",ARRIVED:"arrived"},ROAD_TYPES:{TYPES:{LOCAL:"LOCAL",MINOR:"MINOR",MAJOR:"MAJOR"},WIDTH:{LOCAL:50,MINOR:60,MAJOR:100}},VEHICLE_DIRECTION:{TOWARDS_START:"towards_start",TOWARDS_END:"towards_end"},DISPLAY:{INTERSECTION_RADIUS:45,LOCATION_RADIUS:30,VEHICLE_RADIUS:10}},H={dictionaries:[F.b,F.a,["House","Cottage","Barn","Townhouse","Apartment","Condo","Bungalow","Shop","Mall","Hotel","Cinema","Warehouse","Office","Laboratory","Museum","Library","Gym"]],separator:"_",style:"capital"};z.getUniqueLocationName=function(){var e=Object(F.c)(H).split("_");return e[0]+="'s",e.join(" ")};var J=z,X=function(){function e(){Object(u.a)(this,e)}return Object(p.a)(e,null,[{key:"render",value:function(e,t,a){var n=function(a){Object.entries(t.roads).forEach((function(n){n[0];var o=n[1],r=B.mapArrayCoord(B.getCoordFromWaypoint(o.start,t)),c=B.mapArrayCoord(B.getCoordFromWaypoint(o.end,t));if(r&&c)if("pavement"===a)o.type===J.ROAD_TYPES.TYPES.LOCAL?e.lineWidth=B.scaleSingleCoord(J.ROAD_TYPES.WIDTH.LOCAL):o.type===J.ROAD_TYPES.TYPES.MINOR?e.lineWidth=B.scaleSingleCoord(J.ROAD_TYPES.WIDTH.MINOR):o.type===J.ROAD_TYPES.TYPES.MAJOR&&(e.lineWidth=B.scaleSingleCoord(J.ROAD_TYPES.WIDTH.MAJOR)),e.strokeStyle="black",e.lineJoin="round",e.setLineDash([]),e.beginPath(),e.moveTo.apply(e,Object(m.a)(r)),e.lineTo.apply(e,Object(m.a)(c)),e.stroke();else if("center-line"===a){if(e.lineWidth=B.scaleSingleCoord(1),e.strokeStyle="yellow",o.type===J.ROAD_TYPES.TYPES.LOCAL)e.setLineDash([B.scaleSingleCoord(5),B.scaleSingleCoord(5)]),e.beginPath(),e.moveTo.apply(e,Object(m.a)(r)),e.lineTo.apply(e,Object(m.a)(c)),e.stroke();else if(o.type===J.ROAD_TYPES.TYPES.MINOR)e.setLineDash([]),e.beginPath(),e.moveTo.apply(e,Object(m.a)(r)),e.lineTo.apply(e,Object(m.a)(c)),e.stroke();else if(o.type===J.ROAD_TYPES.TYPES.MAJOR){e.setLineDash([]),e.beginPath(),e.moveTo.apply(e,Object(m.a)(r)),e.lineTo.apply(e,Object(m.a)(c)),e.stroke();var i={x:c[0]-r[0],y:c[1]-r[1]},l={x:-i.y/Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2)),y:i.x/Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2))};e.strokeStyle="white",e.setLineDash([B.scaleSingleCoord(3),B.scaleSingleCoord(5)]),e.beginPath(),e.moveTo(r[0]+B.scaleSingleCoord(25*l.x),r[1]+B.scaleSingleCoord(25*l.y)),e.lineTo(c[0]+B.scaleSingleCoord(25*l.x),c[1]+B.scaleSingleCoord(25*l.y)),e.stroke(),e.beginPath(),e.moveTo(r[0]-B.scaleSingleCoord(25*l.x),r[1]-B.scaleSingleCoord(25*l.y)),e.lineTo(c[0]-B.scaleSingleCoord(25*l.x),c[1]-B.scaleSingleCoord(25*l.y)),e.stroke()}e.lineJoin="round"}}))};n("pavement"),n("center-line")}}]),e}(),G=function(){function e(){Object(u.a)(this,e)}return Object(p.a)(e,null,[{key:"render",value:function(e,t,a){Object.entries(t.locations).forEach((function(t){t[0];var n=t[1],o=B.mapArrayCoord(n.coord);B.checkCoordinateInCanvasView(o,J.DISPLAY.LOCATION_RADIUS)&&(e.lineWidth=2,e.strokeStyle="grey",e.fillStyle="#ff0000",e.setLineDash([]),e.beginPath(),e.arc(o[0],o[1],B.scaleSingleCoord(J.DISPLAY.LOCATION_RADIUS),0,2*Math.PI),e.stroke(),e.fill(),a&&(e.font=B.scaleSingleCoord(25)+"px Roboto",e.strokeStyle="white",e.strokeWidth=B.scaleSingleCoord(2),e.strokeText(n.name,o[0],o[1]),e.fillStyle="black",e.fillText(n.name,o[0],o[1])))}))}}]),e}(),q=function(){function e(){Object(u.a)(this,e)}return Object(p.a)(e,null,[{key:"render",value:function(e,t,a){Object.entries(t.intersections).forEach((function(t){var n=t[0],o=t[1],r=B.mapArrayCoord(o.coord);B.checkCoordinateInCanvasView(r,J.DISPLAY.INTERSECTION_RADIUS)&&(e.lineWidth=2,e.strokeStyle="grey",e.fillStyle="black",e.setLineDash([]),e.beginPath(),e.arc(r[0],r[1],B.scaleSingleCoord(J.DISPLAY.INTERSECTION_RADIUS),0,2*Math.PI),e.fill(),a&&(e.font=B.scaleSingleCoord(50)+"px Roboto",e.strokeStyle="white",e.strokeWidth=B.scaleSingleCoord(2),e.strokeText(n,r[0],r[1]),e.fillStyle="black",e.fillText(n,r[0],r[1])))}))}}]),e}(),Z=function(){function e(){Object(u.a)(this,e)}return Object(p.a)(e,null,[{key:"render",value:function(e,t,a,n){Object.entries(t.vehicles).forEach((function(t){var o=t[0],r=t[1],c=B.mapArrayCoord(r.coord);if(B.checkCoordinateInCanvasView(c,J.DISPLAY.VEHICLE_RADIUS)&&(e.lineWidth=2,e.strokeStyle="grey",e.fillStyle=n===o?"purple":"blue",e.setLineDash([]),e.beginPath(),e.arc(c[0],c[1],B.scaleSingleCoord(J.DISPLAY.VEHICLE_RADIUS),0,2*Math.PI),e.stroke(),e.fill(),a||n===o)){e.lineJoin="round",e.miterLimit=2;var i="".concat(o," | Src: ").concat(r.origin.name," | Dest: ").concat(r.destination.name);e.font=B.scaleSingleCoord(15)+"px Roboto",e.strokeStyle="black",e.strokeWidth=B.scaleSingleCoord(1),e.strokeText(i,c[0],c[1]),e.fillStyle="yellow",e.fillText(i,c[0],c[1])}}))}}]),e}(),K={mapData:null,lastUpdateTimeElapsedList:[]};K.lastUpdateTime=performance.now(),K.lastReduxUpdateTime=performance.now();var Q=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if((t||W().getState().curMode===h.APP_MODE_LIST.VIEW_MAP)&&(K.mapData=e),W().getState().mapDataLoaded||W().dispatch(U.setMapDataLoaded(!0)),W().getState().followCurTripVehicle){var a=W().getState().curTripVehicleId;if(K.mapData.vehicles[a]){var n=K.mapData.vehicles[a].coord;W().dispatch(U.setCanvasProps({centerX:B.scaleSingleCoord(n[0]),centerY:B.scaleSingleCoord(n[1])}))}else W().dispatch(U.setFollowCurTripVehicle(!1)),W().dispatch(U.setCurTripVehicleId(h.COMPLETED_TRIP_VEHICLE_ID))}var o=performance.now(),r=o-K.lastUpdateTime;if(K.lastUpdateTimeElapsedList.push(r),K.lastUpdateTimeElapsedList.length>100&&K.lastUpdateTimeElapsedList.shift(),o-K.lastReduxUpdateTime>1e3){var c=K.lastUpdateTimeElapsedList.reduce((function(e,t){return e+t}),0)/K.lastUpdateTimeElapsedList.length,i=1e3/c;K.lastUpdateTimeElapsedList.length<100&&(i=Number.POSITIVE_INFINITY),W().dispatch(U.setAverageUpdatesPerSecond(i)),K.lastReduxUpdateTime=o}K.lastUpdateTime=o};K.init=function(e){e.on("update-map-data",Q)},K.cleanup=function(e){e.off("update-map-data",Q)},K.updateMapData=function(e){Q(e,!0)};var $=K,ee=function(){function e(){Object(u.a)(this,e)}return Object(p.a)(e,null,[{key:"getMapData",value:function(){return $.mapData}},{key:"getShowLabels",value:function(){var e=W().getState(),t=e.showToggleDynamicLabels,a=e.followCurTripVehicle,n=e.showLabels.dynamic;return t&&n&&!a}},{key:"getCurTripVehicleId",value:function(){return W().getState().curTripVehicleId}},{key:"_renderStatic",value:function(e){var t=this.getMapData(),a=this.getShowLabels(),n=W().getState().canvasDimensions,o=n.width,r=n.height;if(t&&e){var c=e.getContext("2d");c.clearRect(0,0,o,r),c.fillStyle="#dddddd",c.fillRect(0,0,o,r);var i=new Image;i.src="/logo192.png",i.onload=function(){c.drawImage(i,0,0,50,50)},X.render(c,t,a),G.render(c,t,!0),q.render(c,t,!1)}}},{key:"_renderDynamic",value:function(e){var t=this.getMapData(),a=this.getShowLabels(),n=W().getState().canvasDimensions,o=n.width,r=n.height;if(t&&e){var c=e.getContext("2d");c.clearRect(0,0,o,r),Z.render(c,t,a,this.getCurTripVehicleId())}}},{key:"renderAll",value:function(e,t){this._renderStatic(e),this._renderDynamic(t);var a=performance.now(),n=a-this.lastRenderTime;if(this.lastRenderTimeElapsedList.push(n),this.lastRenderTimeElapsedList.length>100&&this.lastRenderTimeElapsedList.shift(),a-this.lastReduxUpdateTime>1e3){var o=1e3/(this.lastRenderTimeElapsedList.reduce((function(e,t){return e+t}),0)/this.lastRenderTimeElapsedList.length);this.lastRenderTimeElapsedList.length<100&&(o=Number.POSITIVE_INFINITY),W().dispatch(U.setAverageRendersPerSecond(o)),this.lastReduxUpdateTime=a}this.lastRenderTime=a}}]),e}();ee.lastRenderTimeElapsedList=[],ee.lastRenderTime=performance.now(),ee.lastReduxUpdateTime=performance.now();var te=a(8),ae=a(125);var ne=Object(te.b)((function(e){return{curMode:e.curMode,mapLoaded:e.mapDataLoaded,showDynamicLabels:e.showLabels.dynamic,showToggleDynamicLabels:e.showToggleDynamicLabels,canvasProps:e.canvasProps,canvasDimensions:e.canvasDimensions,followCurTripVehicle:e.followCurTripVehicle}}))((function(e){var t=e.showToggleDynamicLabels,a=e.dispatch,n=e.canvasProps,c=e.canvasDimensions,i=e.mapLoaded,l=e.followCurTripVehicle,s=Object(o.useRef)(null),d=Object(o.useRef)(null),u=Object(o.useRef)(null);Object(o.useEffect)((function(){a(U.setCanvasDimensions({height:window.innerHeight,width:window.innerWidth})),a(U.setCanvasProps({centerX:0,centerY:0,zoom:.5}))}),[a]);var p=Object(o.useRef)(!1),m=Object(o.useRef)(null);Object(o.useEffect)((function(){var e=function(e){var t=0,n=0;switch(e.key){case"ArrowUp":n=50;break;case"ArrowDown":n=-50;break;case"ArrowLeft":t=50;break;case"ArrowRight":t=-50}a(U.setCanvasPropsDiff({centerX:t,centerY:n,zoom:1}))};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[a]);var f=Object(o.useCallback)((function(e){if(e.preventDefault(),e.stopPropagation(),i){var t=e.pageX,n=e.pageY,o=e.deltaY,r=1;if(o>0?r=.8:o<0&&(r=1.25),l)a(U.setCanvasPropsZoom(r,{x:0,y:0}));else{var d={x:t-s.current.offsetLeft,y:n-s.current.offsetTop},u={x:d.x-c.width/2,y:d.y-c.height/2};a(U.setCanvasPropsZoom(r,u))}}return!1}),[c,a,i,l]);Object(o.useEffect)((function(){if(u.current){a(U.setCanvasOffset({left:u.current.offsetLeft,top:u.current.offsetTop}));var e=u.current;return e.addEventListener("wheel",f,{passive:!1}),function(){e.removeEventListener("wheel",f)}}}),[u,i,a,f]);var E=Object(o.useRef)(null);Object(o.useEffect)((function(){return E.current=window.requestAnimationFrame((function e(){ee.renderAll(s.current,d.current),E.current=window.requestAnimationFrame(e)})),function(){window.cancelAnimationFrame(E.current)}}),[]);var O=function(e){p.current=!1,m.current=null},v=Object(o.useRef)(null);return Object(o.useEffect)((function(){n.zoom<.4?t&&a(U.setShowToggleDynamicLabels(!1)):t||a(U.setShowToggleDynamicLabels(!0))}),[n.zoom,t,a]),r.a.createElement("div",{onMouseDown:function(e){e.preventDefault(),i&&!l&&(p.current=!0,m.current={x:e.screenX,y:e.screenY})},onMouseUp:O,onMouseLeave:O,onMouseMove:function(e){var t=performance.now();if(p.current&&(!v.current||t-v.current>1e3/30)){v.current=t;var n={x:m.current.x,y:m.current.y},o={x:e.screenX,y:e.screenY};a(U.setCanvasPropsDiff({zoom:1,centerX:-(o.x-n.x),centerY:-(o.y-n.y)})),m.current=o}},ref:u,style:{height:c.height,width:c.width,position:"absolute",top:0,left:0,zIndex:-1}},i?r.a.createElement("div",null,r.a.createElement("canvas",{style:{position:"absolute",zIndex:2},ref:d,height:c.height,width:c.width}),r.a.createElement("canvas",{style:{position:"absolute",zIndex:1},ref:s,height:c.height,width:c.width})):r.a.createElement("div",{style:{backgroundColor:"#dddddd",height:"100%",width:"100%",display:"flex",alignContent:"center",alignItems:"center",justifyContent:"center"}},r.a.createElement("div",{style:{display:"flex",alignContent:"center",alignItems:"center",justifyContent:"center",flexDirection:"column"}},r.a.createElement("div",{className:"mb-2"},r.a.createElement(ae.a,{type:"grow",color:"primary",size:"m"})),r.a.createElement("div",null,"Conneting to server..."))))})),oe={},re=function(e,t,a,n){for(var o=0,r=Object.entries(t.intersections);o<r.length;o++){var c=r[o];if(!n.includes(c[0])){var i=c[1];if(B.getDistanceBetweenArrayCoords(i.coord,e)<J.DISPLAY.INTERSECTION_RADIUS+a)return{type:"intersection",id:c[0],data:c[1]}}}return null},ce=function(e,t,a,n){for(var o=0,r=Object.entries(t.locations);o<r.length;o++){var c=r[o];if(!n.includes(c[0])){var i=c[1];if(B.getDistanceBetweenArrayCoords(i.coord,e)<J.DISPLAY.LOCATION_RADIUS+a)return{type:"location",id:c[0],data:c[1]}}}return null};oe.findComponent=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=$.mapData,o=[re,ce],r=0,c=o;r<c.length;r++){var i=c[r],l=i(e,n,t,a);if(l)return l}};var ie=oe,le=a(134),se=a(126),de=a(127),ue=a(128),pe=a(129);function me(e){var t=e.isOpen,a=e.setIsOpen;return r.a.createElement(le.a,{isOpen:t,toggle:function(){a(!t)}},r.a.createElement(se.a,{toggle:function(){a(!t)}},"Low FPS Detected"),r.a.createElement(de.a,null,"It has been detected at the map is running at a lower than optimal frame rate. It may help to hide the labels by toggling the ",r.a.createElement("code",null,"Toggle Labels")," checkbox"),r.a.createElement(ue.a,null,r.a.createElement(pe.a,{color:"primary",onClick:function(){a(!t)}},"OK")))}var fe=a(43);function Ee(e){var t,a=e.sectionName,n=e.children,c=e.openInitial,i=void 0===c||c,l=Object(o.useState)(i),s=Object(d.a)(l,2),u=s[0],p=s[1];return t=u?fe.a:fe.b,r.a.createElement("div",{className:"mx-2 my-2"},r.a.createElement("div",{className:"font-weight-bold",style:{display:"flex",justifyContent:"space-between",alignContent:"center",alignItems:"center"}},a,r.a.createElement("div",{style:{cursor:"pointer"},onClick:function(){p((function(e){return!e}))}},r.a.createElement(t,null))),u&&r.a.createElement("div",null,n),r.a.createElement("hr",{className:"mb-0"}))}var Oe=a(30),ve=a(130),he=a(131);var be=Object(te.b)((function(e){return{selectedComponent:e.selectedComponent,hoveredComponent:e.hoveredComponent}}))((function(e){var t,a=e.hoveredComponent,n=e.selectedComponent,c=e.updateLocationName,i=Object(o.useState)(!1),l=Object(d.a)(i,2),s=l[0],u=l[1],p=Object(o.useState)(""),m=Object(d.a)(p,2),f=m[0],E=m[1],O=a||n;return t=O?r.a.createElement("div",null,r.a.createElement("div",null,"Type: ",O.type),"location"===O.type&&r.a.createElement("div",null,"Name:"," ",s&&c?r.a.createElement(ve.a,{inline:!0,onSubmit:function(e){return e.preventDefault(),c(O.id,f),u(!1),!1}},r.a.createElement(he.a,{style:{fontSize:12},className:"my-1",type:"text",name:"component-name",autoFocus:!0,onBlur:function(){c(O.id,f),u(!1)},onChange:function(e){E(e.target.value)},value:f})):O.data.name?O.data.name:r.a.createElement("span",{style:{color:"grey"}},"No name set"),!s&&c&&r.a.createElement(Oe.a,{className:"ml-2",style:{cursor:"pointer"},onClick:function(){E(O.data.name),u(!0)}})),r.a.createElement("div",null,"Coordiantes: [",O.data.coord[0].toFixed(3),","," ",O.data.coord[1].toFixed(3),"]")):r.a.createElement("div",null,"No component selected"),r.a.createElement("div",{style:{fontSize:12}},t)})),De=a(132),ye=a(133);var Se=Object(te.b)((function(e){return{mapDataLoaded:e.mapDataLoaded,curTripVehicleId:e.curTripVehicleId,followCurTripVehicle:e.followCurTripVehicle,curMode:e.curMode}}))((function(e){var t=e.curMode,a=e.curTripVehicleId,n=e.mapDataLoaded,c=e.socket,i=e.followCurTripVehicle,l=e.dispatch,s=Object(o.useState)(null),u=Object(d.a)(s,2),p=u[0],m=u[1];Object(o.useEffect)((function(){a&&a!==h.COMPLETED_TRIP_VEHICLE_ID&&m($.mapData.vehicles[a])}),[]),Object(o.useEffect)((function(){if(c){var e=function(e){e&&(m(e),l(U.setCurTripVehicleId(e.id)),l(U.setFollowCurTripVehicle(!0)))};return c.on("start-trip-res",e),function(){c.off("start-trip-res",e)}}}),[c,l]);var f=n?Object.values($.mapData.locations):[];f.sort((function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}));var E,O={fontSize:10};return E=t===h.APP_MODE_LIST.CREATE_MAP?r.a.createElement("div",null,"Starting a trip is not allowed when building a map. Switch to View Mode to start a trip."):a&&a!==h.COMPLETED_TRIP_VEHICLE_ID&&p?r.a.createElement("div",{style:{fontSize:12}},r.a.createElement("div",null,r.a.createElement("span",{className:"font-weight-bold"},"Vehicle ID: "),a),r.a.createElement("div",null,r.a.createElement("span",{className:"font-weight-bold"},"Origin: "),p.origin.name),r.a.createElement("div",null,r.a.createElement("span",{className:"font-weight-bold"},"Destination: "),p.destination.name),r.a.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",alignContent:"center"},className:"my-1"},r.a.createElement("input",{type:"checkbox",id:"follow-cur-trip-chkbox",className:"mr-1",checked:i,onChange:function(e){var t=e.target.checked;l(U.setFollowCurTripVehicle(t))}}),r.a.createElement("label",{htmlFor:"follow-cur-trip-chkbox",className:"m-0",style:{userSelect:"none",fontSize:10}},"Toggle Follow Current Trip Vehicle")),r.a.createElement(pe.a,{className:"mt-2",color:"primary",style:{fontSize:10},onClick:function(){m(null),l(U.setCurTripVehicleId(null)),l(U.setFollowCurTripVehicle(!1))}},"Start a New Trip")):r.a.createElement("div",{style:{fontSize:10}},r.a.createElement("div",null,a===h.COMPLETED_TRIP_VEHICLE_ID&&r.a.createElement(De.a,{className:"mb-1 mt-2 p-2",style:{textAlign:"center"},color:"success"},r.a.createElement("div",{className:"font-weight-bold"},"You have reached your destination!"),"You can start a new trip below."),r.a.createElement(ye.a,{for:"navigate-origin",className:"font-weight-bold mb-1 mt-1"},"Origin"),r.a.createElement(he.a,{style:O,type:"select",name:"select",id:"navigate-origin"},f.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id,style:O},e.name)})))),r.a.createElement("div",null,r.a.createElement(ye.a,{for:"navigate-dest",className:"font-weight-bold mb-1 mt-2"},"Destination"),r.a.createElement(he.a,{style:O,type:"select",name:"select",id:"navigate-dest"},f.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id,style:O},e.name)})))),r.a.createElement(pe.a,{className:"mt-2",color:"primary",style:{fontSize:10},onClick:function(){var e,t;e=document.getElementById("navigate-origin").value,t=document.getElementById("navigate-dest").value,c&&c.emit("start-trip",{originId:e,destinationId:t})}},"Navigate")),r.a.createElement("div",null,r.a.createElement("div",{className:"mb-1"},a?"Trip Progress":"Start a Trip"),E)}));var ge=Object(te.b)((function(e){return{showToggleDynamicLabels:e.showToggleDynamicLabels,curMode:e.curMode,showDynamicLabels:e.showLabels.dynamic,followCurTripVehicle:e.followCurTripVehicle}}))((function(e){var t=e.curMode,a=e.showToggleDynamicLabels,n=e.showDynamicLabels,o=e.followCurTripVehicle,c=e.dispatch;return r.a.createElement("div",null,a&&!o&&t===h.APP_MODE_LIST.VIEW_MAP&&r.a.createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",alignContent:"center"},className:"my-1"},r.a.createElement("input",{type:"checkbox",id:"show-labels-chkbox",className:"mr-1",checked:n,onChange:function(e){var t=e.target.checked;c(U.setShowDynamicLabels(t))}}),r.a.createElement("label",{htmlFor:"show-labels-chkbox",className:"m-0",style:{userSelect:"none",fontSize:10}},"Toggle Vehicle Labels")),r.a.createElement("div",null,r.a.createElement(pe.a,{color:"link",style:{fontSize:10,padding:0},onClick:function(){t===h.APP_MODE_LIST.CREATE_MAP?c(U.setCurMode(h.APP_MODE_LIST.VIEW_MAP)):c(U.setCurMode(h.APP_MODE_LIST.CREATE_MAP))}},t===h.APP_MODE_LIST.CREATE_MAP?"Switch to View Mode":"Switch to Create Mode")))}));var Te=Object(te.b)((function(e){return{averageUpdatesPerSecond:e.averageUpdatesPerSecond,averageRendersPerSecond:e.averageRendersPerSecond,mapDataLoaded:e.mapDataLoaded,curMode:e.curMode}}))((function(e){var t,a=e.mapDataLoaded,n=e.averageUpdatesPerSecond,o=e.averageRendersPerSecond,c=e.curMode,i={};if(a){var l=$.mapData;t=r.a.createElement("div",null,r.a.createElement("div",{style:i},"Map ID: ",l.id),r.a.createElement("div",{style:i},"Total Vehicles: ",Object.keys(l.vehicles).length),r.a.createElement("div",{style:i},"Total Intersections:"," ",Object.keys(l.intersections).length),r.a.createElement("div",{style:i},"Total Locations: ",Object.keys(l.locations).length),r.a.createElement("div",{style:i},"Total Roads: ",Object.keys(l.roads).length),c===h.APP_MODE_LIST.VIEW_MAP&&r.a.createElement("div",{style:i},"Avg Updates/Sec: ",n.toFixed(2)),r.a.createElement("div",{style:i},"Avg Renders/Sec: ",o.toFixed(2)))}else t=r.a.createElement("div",null,"Map data not loaded.");return r.a.createElement("div",{style:{fontSize:12}},t)}));function Ce(e){var t=e.buildActionHandler;return r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement(pe.a,{color:"primary",className:"m-1",onClick:function(){t(h.BUILD_ACTIONS.ADD_LOCATION)}},"Add Location"),r.a.createElement(pe.a,{color:"primary",onClick:function(){t(h.BUILD_ACTIONS.ADD_INTERSECTION)},className:"m-1"},"Add Intersection"),r.a.createElement(pe.a,{color:"primary",onClick:function(){t(h.BUILD_ACTIONS.BUILD_MAJOR_ROAD)},className:"m-1"},"Build Major Road"),r.a.createElement(pe.a,{color:"primary",onClick:function(){t(h.BUILD_ACTIONS.BUILD_MINOR_ROAD)},className:"m-1"},"Build Minor Road"),r.a.createElement(pe.a,{color:"primary",onClick:function(){t(h.BUILD_ACTIONS.BUILD_LOCAL_ROAD)},className:"m-1"},"Build Local Road"),r.a.createElement(pe.a,{color:"primary",onClick:function(){t(h.BUILD_ACTIONS.DELETE_COMPONENTS)},className:"m-1"},"Delete Components"),r.a.createElement(pe.a,{color:"primary",onClick:function(){t(h.BUILD_ACTIONS.RESET_POINTER)},className:"m-1"},"Reset Pointer"),r.a.createElement(pe.a,{color:"success",onClick:function(){t(h.BUILD_ACTIONS.SAVE_MAP)},className:"m-1"},"Save Map")))}var Ae=Object(te.b)((function(e){return{curMode:e.curMode}}))((function(e){var t=e.socket,a=e.curMode,n=e.buildActionHandler,o=e.updateLocationName;return r.a.createElement("div",{style:{background:"#ffffffcc",margin:10,display:"flex",flexDirection:"column",flexWrap:"wrap",justifyContent:"space-between",width:300,position:"fixed",borderRadius:5}},r.a.createElement(Ee,{sectionName:"Selected Component"},r.a.createElement(be,{updateLocationName:o})),r.a.createElement(Ee,{sectionName:"Navigator"},a===h.APP_MODE_LIST.VIEW_MAP?r.a.createElement(Se,{socket:t}):r.a.createElement(Ce,{buildActionHandler:n})),r.a.createElement(Ee,{sectionName:"Map Stats"},r.a.createElement(Te,null)),r.a.createElement(Ee,{sectionName:"Map Settings"},r.a.createElement(ge,null)))}));var Ie=Object(te.b)((function(e){return{showAboutModal:e.showAboutModal}}))((function(e){var t=e.showAboutModal,a=e.dispatch,n=function(e){a(U.setShowAboutModal(e))},o=t,c=r.a.createElement(le.a,{isOpen:o,toggle:function(){n(!o)}},r.a.createElement(se.a,{toggle:function(){n(!o)}},"About"),r.a.createElement(de.a,null,"About the app."),r.a.createElement(ue.a,null,r.a.createElement(pe.a,{color:"primary",onClick:function(){n(!o)}},"OK")));return r.a.createElement("div",null,t?c:r.a.createElement("div",{style:{margin:5,position:"fixed",right:0,top:0,cursor:"pointer"},onClick:function(){n(!0)}},r.a.createElement(Oe.b,{size:25})))}));var _e=Object(te.b)((function(e){return{mapDataLoaded:e.mapDataLoaded,averageUpdatesPerSecond:e.averageUpdatesPerSecond,selectedComponent:e.selectedComponent,hoveredComponent:e.hoveredComponent,showDynamicLabels:e.showLabels.dynamic,showAboutModal:e.showAboutModal,showLowFpsWarning:e.showLowFpsWarning,canvasOffset:e.canvasOffset}}))((function(e){var t=e.onMouseMove,a=e.onMouseDown,n=e.curPointerRadius,c=e.curPointerComponentId,i=e.cursorStyle,l=e.socket,s=e.averageUpdatesPerSecond,d=e.selectedComponent,u=e.hoveredComponent,p=e.dispatch,m=e.showDynamicLabels,f=e.showLowFpsWarning,E=e.mapDataLoaded,O=e.canvasOffset,v=e.buildActionHandler,h=e.updateLocationName,b=Object(o.useRef)(null),D=function(e){var t=e.pageX,a=e.pageY,n=[t-O.left,a-O.top];return B.unmapArrayCoord(n)};return Object(o.useEffect)((function(){s<20&&m&&p(U.setShowFpsWarning(!0))}),[s,m,p]),r.a.createElement("div",null,f&&r.a.createElement(me,{isOpen:f,setIsOpen:function(e){p(U.setShowFpsWarning(e))}}),r.a.createElement(Ae,{socket:l,buildActionHandler:v,updateLocationName:h}),r.a.createElement(Ie,null),r.a.createElement("div",{onMouseMove:function(e){if(E&&b&&b.current){var a=D(e);t&&t(a);var o=ie.findComponent(a,n,[c]);(u?u.id:u)!==(o?o.id:o)&&p(U.setHoveredComponent(o))}},onMouseDown:function(e){if(b&&b.current){var t=D(e);a&&a(t),(!d||u&&d.id!==u.id)&&p(U.setSelectedComponent(u))}},ref:b,style:{cursor:i||(u?"pointer":"move")}},r.a.createElement(ne,null)))})),Le=a(68),Pe="intersection",we="location",Re="none",Me="road",je="delete";var Ne=Object(te.b)((function(e){return{curMode:e.curMode,selectedComponent:e.selectedComponent,hoveredComponent:e.hoveredComponent}}))((function(e){e.dispatch;var t=e.curMode,a=(e.selectedComponent,e.hoveredComponent),n=Object(o.useRef)(JSON.parse(localStorage.getItem("saved-map-data"))||Le),c=Object(o.useRef)(null),i=Object(o.useState)(null),u=Object(d.a)(i,2),p=u[0],m=u[1],f=Object(o.useState)(null),E=Object(d.a)(f,2),O=E[0],v=E[1],b=Object(o.useState)(Re),D=Object(d.a)(b,2),y=D[0],S=D[1];Object(o.useEffect)((function(){console.log(t),$.updateMapData(n.current)}),[t]);var g=function(e){"Escape"===e.key&&(S(Re),c.current=null)};Object(o.useEffect)((function(){return window.addEventListener("keydown",g),function(){window.removeEventListener("keydown",g)}}),[]),Object(o.useEffect)((function(){var e=setInterval((function(){localStorage.setItem("saved-map-data",JSON.stringify(T()))}),5e3);return function(){clearInterval(e)}}),[]);var T=function(){return{id:"map_".concat(B.generateShortUuid()),locations:n.current.locations,intersections:n.current.intersections,vehicles:{},roads:n.current.roads}},C=function(e){if(e&&e.id){var t=JSON.parse(JSON.stringify(n.current));t.intersections[e.id]&&delete t.intersections[e.id],t.locations[e.id]&&delete t.locations[e.id];for(var a=0,o=Object.keys(n.current.roads);a<o.length;a++){var r=o[a];n.current.roads[r].start!==e.id&&n.current.roads[r].end!==e.id||delete t.roads[r]}n.current=t,c.current=null,$.updateMapData(t)}},A=0;y===we?A=J.DISPLAY.LOCATION_RADIUS:y===Pe&&(A=J.DISPLAY.INTERSECTION_RADIUS);var I=null;return y===Me&&p?I="crosshair":y===je&&(I="no-drop"),r.a.createElement("div",{className:"mt-1"},r.a.createElement("div",null,r.a.createElement(_e,{onMouseMove:function(e){if(y===Pe){var t=c.current;t&&t.includes("intersection")||(t="intersection_".concat(B.generateShortUuid())),c.current=t;var a=Object(s.a)(Object(s.a)({},$.mapData),{},{intersections:Object(s.a)(Object(s.a)({},$.mapData.intersections),{},Object(l.a)({},t,Object(s.a)(Object(s.a)({},$.mapData.intersections[t]),{},{id:t,coord:e})))});$.updateMapData(a)}else if(y===we){var o=c.current,r=null,i=!1;o&&o.includes("location")||(o="location_".concat(B.generateShortUuid()),r=J.getUniqueLocationName(),i=!0),c.current=o;var d=Object(s.a)(Object(s.a)({},$.mapData),{},{locations:Object(s.a)(Object(s.a)({},$.mapData.locations),{},Object(l.a)({},o,Object(s.a)(Object(s.a)({},$.mapData.locations[o]),{},{coord:e})))});i&&(d.locations[o].id=o,d.locations[o].name=r),$.updateMapData(d)}else $.updateMapData(n.current),c.current=null},onMouseDown:function(e){if(y===Pe||y===we)a||(n.current=$.mapData,c.current=null);else if(y===Me){if(a)if(p){var t="road_".concat(B.generateShortUuid()),o=Object(s.a)(Object(s.a)({},n.current),{},{roads:Object(s.a)(Object(s.a)({},n.current.roads),{},Object(l.a)({},t,{id:t,type:O,start:p,end:a.id}))});n.current=o,$.updateMapData(o),m(a.id)}else m(a.id)}else y===je&&a&&C(a)},curPointerRadius:A,curPointerComponentId:c.current,cursorStyle:I,buildActionHandler:function(e){switch(e){case h.BUILD_ACTIONS.ADD_LOCATION:$.updateMapData(n.current),S(we),c.current=null;break;case h.BUILD_ACTIONS.ADD_INTERSECTION:$.updateMapData(n.current),S(Pe),c.current=null;break;case h.BUILD_ACTIONS.BUILD_MAJOR_ROAD:$.updateMapData(n.current),S(Me),v(J.ROAD_TYPES.TYPES.MAJOR);break;case h.BUILD_ACTIONS.BUILD_MINOR_ROAD:$.updateMapData(n.current),S(Me),v(J.ROAD_TYPES.TYPES.MINOR);break;case h.BUILD_ACTIONS.BUILD_LOCAL_ROAD:$.updateMapData(n.current),S(Me),v(J.ROAD_TYPES.TYPES.LOCAL);break;case h.BUILD_ACTIONS.DELETE_COMPONENTS:$.updateMapData(n.current),S(je),c.current=null;break;case h.BUILD_ACTIONS.RESET_POINTER:m(null),$.updateMapData(n.current),S(Re),c.current=null;break;case h.BUILD_ACTIONS.SAVE_MAP:!function(){var e=T(),t="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),a=document.createElement("a");a.setAttribute("href",t),a.setAttribute("download",e.id+".json"),document.body.appendChild(a),a.click(),a.remove()}()}},updateLocationName:function(e,t){$.mapData.locations[e].name=t,n.current=$.mapData}})))}));var ke=Object(te.b)((function(e){return{curMode:e.curMode}}))((function(e){var t,a=e.socket,n=e.curMode;return e.dispatch,Object(o.useEffect)((function(){return $.init(a),function(){$.cleanup(a),a.disconnect()}}),[]),n===h.APP_MODE_LIST.VIEW_MAP?t=r.a.createElement(_e,{socket:a}):n===h.APP_MODE_LIST.CREATE_MAP&&(t=r.a.createElement(Ne,null)),r.a.createElement("div",{className:"App"},t)})),Ue=(a(91),a(69)),Ve="http://localhost:3001";Ve="https://auto-drive-simulator-api.herokuapp.com/";var xe=a.n(Ue)()(Ve);i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(te.a,{store:n=Object(O.createStore)(x,Object(Y.composeWithDevTools)(Object(O.applyMiddleware)(v.a)))},r.a.createElement(ke,{socket:xe}))),document.getElementById("root"))},68:function(e){e.exports=JSON.parse('{"id":"map_8fzBXojVN4DkjwGhs3p3ks","locations":{},"intersections":{"intersection_0":{"id":"intersection_0","coord":[0,0]},"intersection_1":{"id":"intersection_1","coord":[0,1000]}},"vehicles":{},"roads":{"road_0":{"id":"road_0","type":"MAJOR","start":"intersection_0","end":"intersection_1"}}}')},70:function(e,t,a){e.exports=a(124)}},[[70,1,2]]]);
//# sourceMappingURL=main.34b8ad1f.chunk.js.map